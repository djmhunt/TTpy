
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>data &#8212; pyHPDM 0.9.9 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyHPDM 0.9.9 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for data</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module allows for the importing of participant data for use in fitting</span>

<span class="sd">:Author: Dominic Hunt</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span><span class="p">,</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">import</span> <span class="nn">utils</span>


<div class="viewcode-block" id="LengthError"><a class="viewcode-back" href="../data.html#data.LengthError">[docs]</a><span class="k">class</span> <span class="nc">LengthError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="IDError"><a class="viewcode-back" href="../data.html#data.IDError">[docs]</a><span class="k">class</span> <span class="nc">IDError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="DimentionError"><a class="viewcode-back" href="../data.html#data.DimentionError">[docs]</a><span class="k">class</span> <span class="nc">DimentionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="FileTypeError"><a class="viewcode-back" href="../data.html#data.FileTypeError">[docs]</a><span class="k">class</span> <span class="nc">FileTypeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="FileError"><a class="viewcode-back" href="../data.html#data.FileError">[docs]</a><span class="k">class</span> <span class="nc">FileError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="FoldersError"><a class="viewcode-back" href="../data.html#data.FoldersError">[docs]</a><span class="k">class</span> <span class="nc">FoldersError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ProcessingError"><a class="viewcode-back" href="../data.html#data.ProcessingError">[docs]</a><span class="k">class</span> <span class="nc">ProcessingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<span class="n">DATA_KEYWORDS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;filename&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="s2">&quot;participant_ID&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;folder&quot;</span><span class="p">:</span> <span class="s2">&quot;folder&quot;</span><span class="p">}</span>


<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../data.html#data.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>

<div class="viewcode-block" id="Data.load_data"><a class="viewcode-back" href="../data.html#data.Data.load_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                  <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span>
                  <span class="n">folders</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                  <span class="n">file_name_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">terminal_ID</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">split_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">participantID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">choices</span><span class="o">=</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span>
                  <span class="n">feedbacks</span><span class="o">=</span><span class="s1">&#39;feedbacks&#39;</span><span class="p">,</span>
                  <span class="n">stimuli</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">action_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">group_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">extra_processing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">data_read_options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import data from a folder. This is a wrapper function for the other import methods</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_type : string, optional</span>
<span class="sd">            The file type of the data, from ``mat``, ``csv``, ``xlsx`` and ``pkl``. Default is ``csv``</span>
<span class="sd">        folders : string or list of strings, optional</span>
<span class="sd">            The folder or folders where the data can be found. Default is the current folder.</span>
<span class="sd">        file_name_filter : callable, string, list of strings or None, optional</span>
<span class="sd">            A function to process the file names or a list of possible prefixes as strings or a single string.</span>
<span class="sd">            Default ``None``, no file names removed</span>
<span class="sd">        terminal_ID : bool, optional</span>
<span class="sd">            Is there an ID number at the end of the filename? If not then a more general search will be performed.</span>
<span class="sd">            Default ``True``</span>
<span class="sd">        split_by : string or list of strings, optional</span>
<span class="sd">            If multiple participant datasets are in one file sheet, this specifies the column or columns that can</span>
<span class="sd">            distinguish and identify the rows for each participant. Default ``None``</span>
<span class="sd">        participantID : string, optional</span>
<span class="sd">            The dict key where the participant ID can be found. Default ``None``, which results in the file name being</span>
<span class="sd">            used.</span>
<span class="sd">        choices : string, optional</span>
<span class="sd">            The dict key where the participant choices can be found. Default ``&#39;actions&#39;``</span>
<span class="sd">        feedbacks : string, optional</span>
<span class="sd">            The dict key where the feedbacks the participant received can be found. Default ``&#39;feedbacks&#39;``</span>
<span class="sd">        stimuli : string or list of strings, optional</span>
<span class="sd">            The dict keys where the stimulus cues for each trial can be found. Default ``&#39;None&#39;``</span>
<span class="sd">        action_options : string or list of strings or None or one element list with a list, optional</span>
<span class="sd">            If a string or list of strings these are treated as dict keys where the valid actions for each trial can</span>
<span class="sd">            be found. If None then all trials will use all available actions. If the list contains one list then it will</span>
<span class="sd">            be treated as a list of valid actions for each trialstep. Default ``&#39;None&#39;``</span>
<span class="sd">        group_by : list of strings, optional</span>
<span class="sd">            A list of parts of filenames that are repeated across participants, identifying all the files that should</span>
<span class="sd">            be grouped together to form one participants data. The rest of the filename is assumed to identify the</span>
<span class="sd">            participant. Default is ``None``</span>
<span class="sd">        extra_processing : callable, optional</span>
<span class="sd">            A function that modifies the dictionary of data read for each participant in such that it is appropriate</span>
<span class="sd">            for fitting. Default is ``None``</span>
<span class="sd">        data_read_options : dict, optional</span>
<span class="sd">            The keyword arguments for the data importing method chosen</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Data : Data class instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">folders</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">folder_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">folders</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">folders</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">folder_list</span> <span class="o">=</span> <span class="n">folders</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FoldersError</span><span class="p">(</span><span class="s1">&#39;``folders`` must be a string or a list of strings. Found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">folders</span><span class="p">)))</span>

        <span class="n">dat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folder_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;mat&#39;</span><span class="p">:</span>
                <span class="n">subdat</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_mat</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                                      <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">,</span>
                                      <span class="n">terminal_ID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">,</span>
                                      <span class="n">participantID</span><span class="o">=</span><span class="n">participantID</span><span class="p">,</span>
                                      <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                                      <span class="n">feedbacks</span><span class="o">=</span><span class="n">feedbacks</span><span class="p">,</span>
                                      <span class="n">stimuli</span><span class="o">=</span><span class="n">stimuli</span><span class="p">,</span>
                                      <span class="n">action_options</span><span class="o">=</span><span class="n">action_options</span><span class="p">,</span>
                                      <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">,</span>
                                      <span class="n">extra_processing</span><span class="o">=</span><span class="n">extra_processing</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                <span class="n">subdat</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                                      <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">,</span>
                                      <span class="n">terminal_ID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">,</span>
                                      <span class="n">split_by</span><span class="o">=</span><span class="n">split_by</span><span class="p">,</span>
                                      <span class="n">participantID</span><span class="o">=</span><span class="n">participantID</span><span class="p">,</span>
                                      <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                                      <span class="n">feedbacks</span><span class="o">=</span><span class="n">feedbacks</span><span class="p">,</span>
                                      <span class="n">stimuli</span><span class="o">=</span><span class="n">stimuli</span><span class="p">,</span>
                                      <span class="n">action_options</span><span class="o">=</span><span class="n">action_options</span><span class="p">,</span>
                                      <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">,</span>
                                      <span class="n">extra_processing</span><span class="o">=</span><span class="n">extra_processing</span><span class="p">,</span>
                                      <span class="n">csv_read_options</span><span class="o">=</span><span class="n">data_read_options</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
                <span class="n">subdat</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_xlsx</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                                       <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">,</span>
                                       <span class="n">terminal_ID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">,</span>
                                       <span class="n">split_by</span><span class="o">=</span><span class="n">split_by</span><span class="p">,</span>
                                       <span class="n">participantID</span><span class="o">=</span><span class="n">participantID</span><span class="p">,</span>
                                       <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                                       <span class="n">feedbacks</span><span class="o">=</span><span class="n">feedbacks</span><span class="p">,</span>
                                       <span class="n">stimuli</span><span class="o">=</span><span class="n">stimuli</span><span class="p">,</span>
                                       <span class="n">action_options</span><span class="o">=</span><span class="n">action_options</span><span class="p">,</span>
                                       <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">,</span>
                                       <span class="n">extra_processing</span><span class="o">=</span><span class="n">extra_processing</span><span class="p">,</span>
                                       <span class="n">xlsx_read_options</span><span class="o">=</span><span class="n">data_read_options</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;pkl&#39;</span><span class="p">:</span>
                <span class="n">subdat</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_pkl</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                                      <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">,</span>
                                      <span class="n">terminal_ID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">,</span>
                                      <span class="n">participantID</span><span class="o">=</span><span class="n">participantID</span><span class="p">,</span>
                                      <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                                      <span class="n">feedbacks</span><span class="o">=</span><span class="n">feedbacks</span><span class="p">,</span>
                                      <span class="n">stimuli</span><span class="o">=</span><span class="n">stimuli</span><span class="p">,</span>
                                      <span class="n">action_options</span><span class="o">=</span><span class="n">action_options</span><span class="p">,</span>
                                      <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">,</span>
                                      <span class="n">extra_processing</span><span class="o">=</span><span class="n">extra_processing</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileTypeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a supported file type. Please use ``mat``, ``csv``, ``xlsx`` or ``pkl``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_type</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">dat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">subdat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dat</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">subdat</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dat</span></div>

<div class="viewcode-block" id="Data.from_mat"><a class="viewcode-back" href="../data.html#data.Data.from_mat">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_mat</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                 <span class="n">file_name_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">terminal_ID</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">participantID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span>
                 <span class="n">feedbacks</span><span class="o">=</span><span class="s1">&#39;feedbacks&#39;</span><span class="p">,</span>
                 <span class="n">stimuli</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">action_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">group_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">extra_processing</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import data from a folder full of .mat files, where each file contains the information of one participant</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : string, optional</span>
<span class="sd">            The folder where the data can be found. Default is the current folder.</span>
<span class="sd">        file_name_filter : callable, string, list of strings or None, optional</span>
<span class="sd">            A function to process the file names or a list of possible prefixes as strings or a single string.</span>
<span class="sd">            Default ``None``, no file names removed</span>
<span class="sd">        terminal_ID : bool, optional</span>
<span class="sd">            Is there an ID number at the end of the filename? If not then a more general search will be performed.</span>
<span class="sd">            Default ``True``</span>
<span class="sd">        participantID : string, optional</span>
<span class="sd">            The dict key where the participant ID can be found. Default ``None``, which results in the file name being</span>
<span class="sd">            used.</span>
<span class="sd">        choices : string, optional</span>
<span class="sd">            The dict key where the participant choices can be found. Default ``&#39;actions&#39;``</span>
<span class="sd">        feedbacks : string, optional</span>
<span class="sd">            The dict key where the feedbacks the participant received can be found. Default ``&#39;feedbacks&#39;``</span>
<span class="sd">        stimuli : string or list of strings, optional</span>
<span class="sd">            The dict keys where the stimulus cues for each trial can be found. Default ``&#39;None&#39;``</span>
<span class="sd">        action_options : string or list of strings or None or one element list with a list, optional</span>
<span class="sd">            If a string or list of strings these are treated as dict keys where the valid actions for each trial can</span>
<span class="sd">            be found. If None then all trials will use all available actions. If the list contains one list then it will</span>
<span class="sd">            be treated as a list of valid actions for each trialstep. Default ``&#39;None&#39;``</span>
<span class="sd">        group_by : list of strings, optional</span>
<span class="sd">            A list of parts of filenames that are repeated across participants, identifying all the files that should</span>
<span class="sd">            be grouped together to form one participants data. The rest of the filename is assumed to identify the</span>
<span class="sd">            participant. Default is ``None``</span>
<span class="sd">        extra_processing : callable, optional</span>
<span class="sd">            A function that modifies the dictionary of data read for each participant in such that it is appropriate</span>
<span class="sd">            for fitting. Default is ``None``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Data : Data class instance</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.io.loadmat</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__folder_path_cleaning</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">files</span><span class="p">,</span> <span class="n">file_IDs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__locate_files</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">,</span> <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">,</span> <span class="n">terminal_ID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">)</span>

        <span class="n">participant_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">file_IDs</span><span class="p">):</span>

            <span class="n">file_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]:</span> <span class="n">f</span><span class="p">,</span>
                         <span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]:</span> <span class="n">folder_path</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">participantID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_data</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">i</span>

            <span class="n">mat</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">+</span> <span class="n">f</span><span class="p">,</span> <span class="n">struct_as_record</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">squeeze_me</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mat</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;__&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">matlab</span><span class="o">.</span><span class="n">mio5_params</span><span class="o">.</span><span class="n">mat_struct</span><span class="p">:</span>
                    <span class="n">data_structure</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">_fieldnames</span><span class="p">}</span>
                    <span class="n">file_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data_structure</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">file_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="n">participant_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">participantID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">participantID</span> <span class="o">=</span> <span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>

        <span class="n">participant_processed_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__clean_data</span><span class="p">(</span><span class="n">participant_data</span><span class="p">,</span>
                                                      <span class="n">extra_processing</span><span class="o">=</span><span class="n">extra_processing</span><span class="p">,</span>
                                                      <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">participant_processed_data</span><span class="p">,</span>
                   <span class="n">participantID</span><span class="o">=</span><span class="n">participantID</span><span class="p">,</span>
                   <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                   <span class="n">feedbacks</span><span class="o">=</span><span class="n">feedbacks</span><span class="p">,</span>
                   <span class="n">stimuli</span><span class="o">=</span><span class="n">stimuli</span><span class="p">,</span>
                   <span class="n">action_options</span><span class="o">=</span><span class="n">action_options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.from_csv"><a class="viewcode-back" href="../data.html#data.Data.from_csv">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                 <span class="n">file_name_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">terminal_ID</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">split_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">participantID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span>
                 <span class="n">feedbacks</span><span class="o">=</span><span class="s1">&#39;feedbacks&#39;</span><span class="p">,</span>
                 <span class="n">stimuli</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">action_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">group_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">extra_processing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">csv_read_options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import data from a folder full of .csv files, where each file contains the information of one participant</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : string, optional</span>
<span class="sd">            The folder where the data can be found. Default is the current folder.</span>
<span class="sd">        file_name_filter : callable, string, list of strings or None, optional</span>
<span class="sd">            A function to process the file names or a list of possible prefixes as strings or a single string.</span>
<span class="sd">            Default ``None``, no file names removed</span>
<span class="sd">        terminal_ID : bool, optional</span>
<span class="sd">            Is there an ID number at the end of the filename? If not then a more general search will be performed.</span>
<span class="sd">            Default ``True``</span>
<span class="sd">        split_by : string or list of strings, optional</span>
<span class="sd">            If multiple participants datasets are in one file sheet, this specifies the column or columns that can</span>
<span class="sd">            distinguish and identify the rows for each participant. Default ``None``</span>
<span class="sd">        participantID : string, optional</span>
<span class="sd">            The dict key where the participant ID can be found. Default ``None``, which results in the file name being</span>
<span class="sd">            used.</span>
<span class="sd">        choices : string, optional</span>
<span class="sd">            The dict key where the participant choices can be found. Default ``&#39;actions&#39;``</span>
<span class="sd">        feedbacks : string, optional</span>
<span class="sd">            The dict key where the feedbacks the participant received can be found. Default ``&#39;feedbacks&#39;``</span>
<span class="sd">        stimuli : string or list of strings, optional</span>
<span class="sd">            The dict keys where the stimulus cues for each trial can be found. Default ``&#39;None&#39;``</span>
<span class="sd">        action_options : string or list of strings or None or one element list with a list, optional</span>
<span class="sd">            If a string or list of strings these are treated as dict keys where the valid actions for each trial can</span>
<span class="sd">            be found. If None then all trials will use all available actions. If the list contains one list then it will</span>
<span class="sd">            be treated as a list of valid actions for each trialstep. Default ``&#39;None&#39;``</span>
<span class="sd">        group_by : list of strings, optional</span>
<span class="sd">            A list of parts of filenames that are repeated across participants, identifying all the files that should</span>
<span class="sd">            be grouped together to form one participants data. The rest of the filename is assumed to identify the</span>
<span class="sd">            participant. Default is ``None``</span>
<span class="sd">        extra_processing : callable, optional</span>
<span class="sd">            A function that modifies the dictionary of data read for each participant in such that it is appropriate</span>
<span class="sd">            for fitting. Default is ``None``</span>
<span class="sd">        csv_read_options : dict, optional</span>
<span class="sd">            The keyword arguments for pandas.read_csv. Default ``{}``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Data : Data class instance</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pandas.read_csv</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__folder_path_cleaning</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">files</span><span class="p">,</span> <span class="n">file_IDs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__locate_files</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">,</span>
                                             <span class="n">terminal_ID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">split_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">split_by</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">split_by</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">split_by</span> <span class="o">=</span> <span class="p">[</span><span class="n">split_by</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">split_by</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">split_by</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;A split_by list should only contain strings. Found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;split_by should be a string or a list of strings. Found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">split_by</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">csv_read_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">csv_read_options</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">participant_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">participantID_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">fileID</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">file_IDs</span><span class="p">):</span>

            <span class="n">dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">csv_read_options</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">split_by</span><span class="p">:</span>
                <span class="n">classifier_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">split_by</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Data split by contains a column that does not exist: ``</span><span class="si">{}</span><span class="s1">``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)]:</span>
                        <span class="n">sSorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">s</span><span class="p">])))</span>
                        <span class="n">classifier_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sSorted</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">classifier_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__sort_strings</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">s</span><span class="p">])),</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">participants</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">listMerge</span><span class="p">(</span><span class="o">*</span><span class="n">classifier_list</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">participants</span><span class="p">:</span>
                    <span class="n">sub_dat</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[(</span><span class="n">dat</span><span class="p">[</span><span class="n">split_by</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
                    <span class="n">sub_dat_dict</span> <span class="o">=</span> <span class="n">sub_dat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
                    <span class="n">sub_dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="n">sub_dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">folder_path</span>
                    <span class="k">if</span> <span class="n">participantID</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">participantID</span> <span class="o">==</span> <span class="n">split_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">participantID_changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">sub_dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">p</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sub_dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">participant_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_dat_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dat_dict</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
                <span class="n">dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="n">dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">folder_path</span>
                <span class="k">if</span> <span class="n">participantID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">fileID</span>
                    <span class="n">participantID_changed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">participantID</span> <span class="ow">in</span> <span class="n">dat_dict</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dat_dict</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">list_all_equal</span><span class="p">(</span><span class="n">dat_dict</span><span class="p">[</span><span class="n">participantID</span><span class="p">]):</span>
                        <span class="n">dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dat_dict</span><span class="p">[</span><span class="n">participantID</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">participantID_changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;participantID&#39;s column, </span><span class="si">{}</span><span class="s2">, had more than one value&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">participantID</span><span class="p">))</span>

                <span class="n">participant_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dat_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">participantID_changed</span><span class="p">:</span>
            <span class="n">participantID</span> <span class="o">=</span> <span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>

        <span class="n">participant_processed_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__clean_data</span><span class="p">(</span><span class="n">participant_data</span><span class="p">,</span>
                                                      <span class="n">extra_processing</span><span class="o">=</span><span class="n">extra_processing</span><span class="p">,</span>
                                                      <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">participant_processed_data</span><span class="p">,</span>
                   <span class="n">participantID</span><span class="o">=</span><span class="n">participantID</span><span class="p">,</span>
                   <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                   <span class="n">feedbacks</span><span class="o">=</span><span class="n">feedbacks</span><span class="p">,</span>
                   <span class="n">stimuli</span><span class="o">=</span><span class="n">stimuli</span><span class="p">,</span>
                   <span class="n">action_options</span><span class="o">=</span><span class="n">action_options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.from_xlsx"><a class="viewcode-back" href="../data.html#data.Data.from_xlsx">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_xlsx</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                  <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                  <span class="n">file_name_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">terminal_ID</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">split_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">participantID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">choices</span><span class="o">=</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span>
                  <span class="n">feedbacks</span><span class="o">=</span><span class="s1">&#39;feedbacks&#39;</span><span class="p">,</span>
                  <span class="n">stimuli</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">action_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">group_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">extra_processing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">xlsx_read_options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import data from a folder full of .xlsx files, where each file contains the information of one participant</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : string, optional</span>
<span class="sd">            The folder where the data can be found. Default is the current folder.</span>
<span class="sd">        file_name_filter : callable, string, list of strings or None, optional</span>
<span class="sd">            A function to process the file names or a list of possible prefixes as strings or a single string.</span>
<span class="sd">            Default ``None``, no file names removed</span>
<span class="sd">        terminal_ID : bool, optional</span>
<span class="sd">            Is there an ID number at the end of the filename? If not then a more general search will be performed.</span>
<span class="sd">            Default ``True``</span>
<span class="sd">        split_by : string or list of strings, optional</span>
<span class="sd">            If multiple participants datasets are in one file sheet, this specifies the column or columns that can</span>
<span class="sd">            distinguish and identify the rows for each participant. Default ``None``</span>
<span class="sd">        participantID : string, optional</span>
<span class="sd">            The dict key where the participant ID can be found. Default ``None``, which results in the file name being</span>
<span class="sd">            used.</span>
<span class="sd">        choices : string, optional</span>
<span class="sd">            The dict key where the participant choices can be found. Default ``&#39;actions&#39;``</span>
<span class="sd">        feedbacks : string, optional</span>
<span class="sd">            The dict key where the feedbacks the participant received can be found. Default ``&#39;feedbacks&#39;``</span>
<span class="sd">        stimuli : string or list of strings, optional</span>
<span class="sd">            The dict keys where the stimulus cues for each trial can be found. Default ``&#39;None&#39;``</span>
<span class="sd">        action_options : string or list of strings or None or one element list with a list, optional</span>
<span class="sd">            If a string or list of strings these are treated as dict keys where the valid actions for each trial can</span>
<span class="sd">            be found. If None then all trials will use all available actions. If the list contains one list then it will</span>
<span class="sd">            be treated as a list of valid actions for each trialstep. Default ``&#39;None&#39;``</span>
<span class="sd">        group_by : list of strings, optional</span>
<span class="sd">            A list of parts of filenames that are repeated across participants, identifying all the files that should</span>
<span class="sd">            be grouped together to form one participants data. The rest of the filename is assumed to identify the</span>
<span class="sd">            participant. Default is ``None``</span>
<span class="sd">        extra_processing : callable, optional</span>
<span class="sd">            A function that modifies the dictionary of data read for each participant in such that it is appropriate</span>
<span class="sd">            for fitting. Default is ``None``</span>
<span class="sd">        xlsx_read_options : dict, optional</span>
<span class="sd">            The keyword arguments for pandas.read_excel</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Data : Data class instance</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pandas.read_excel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__folder_path_cleaning</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">files</span><span class="p">,</span> <span class="n">file_IDs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__locate_files</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;xlsx&quot;</span><span class="p">,</span> <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">,</span>
                                             <span class="n">terminal_ID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">split_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">split_by</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">split_by</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">split_by</span> <span class="o">=</span> <span class="p">[</span><span class="n">split_by</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">split_by</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">split_by</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;A split_by list should only contain strings. Found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;split_by should be a string or a list of strings. Found </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">split_by</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">xlsx_read_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlsx_read_options</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">participant_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">participantID_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">fileID</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">file_IDs</span><span class="p">):</span>

            <span class="c1"># In case the file is open, this will in fact be a temporary file and not a valid file.</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;~$&#39;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">xlsx_read_options</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">split_by</span><span class="p">:</span>
                <span class="n">classifier_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">split_by</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Data split by contains a column that does not exist: ``</span><span class="si">{}</span><span class="s1">``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)]:</span>
                        <span class="n">sSorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">s</span><span class="p">])))</span>
                        <span class="n">classifier_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sSorted</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">classifier_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__sort_strings</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">s</span><span class="p">])),</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

                <span class="n">participants</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">listMerge</span><span class="p">(</span><span class="o">*</span><span class="n">classifier_list</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">participants</span><span class="p">:</span>
                    <span class="n">sub_dat</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[(</span><span class="n">dat</span><span class="p">[</span><span class="n">split_by</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
                    <span class="n">sub_dat_dict</span> <span class="o">=</span> <span class="n">sub_dat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
                    <span class="n">sub_dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="n">sub_dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">folder_path</span>
                    <span class="k">if</span> <span class="n">participantID</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">participantID</span> <span class="o">==</span> <span class="n">split_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">participantID_changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">sub_dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">p</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sub_dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">participant_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_dat_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dat_dict</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>
                <span class="n">dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="n">dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">folder_path</span>
                <span class="k">if</span> <span class="n">participantID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">fileID</span>
                    <span class="n">participantID_changed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">participantID</span> <span class="ow">in</span> <span class="n">dat_dict</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dat_dict</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">list_all_equal</span><span class="p">(</span><span class="n">dat_dict</span><span class="p">[</span><span class="n">participantID</span><span class="p">]):</span>
                        <span class="n">dat_dict</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dat_dict</span><span class="p">[</span><span class="n">participantID</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">participantID_changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;participantID&#39;s column, </span><span class="si">{}</span><span class="s2">, had more than one value&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">participantID</span><span class="p">))</span>

                <span class="n">participant_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dat_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">participantID_changed</span><span class="p">:</span>
            <span class="n">participantID</span> <span class="o">=</span> <span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>

        <span class="n">participant_processed_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__clean_data</span><span class="p">(</span><span class="n">participant_data</span><span class="p">,</span>
                                                      <span class="n">extra_processing</span><span class="o">=</span><span class="n">extra_processing</span><span class="p">,</span>
                                                      <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">participant_processed_data</span><span class="p">,</span>
                   <span class="n">participantID</span><span class="o">=</span><span class="n">participantID</span><span class="p">,</span>
                   <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                   <span class="n">feedbacks</span><span class="o">=</span><span class="n">feedbacks</span><span class="p">,</span>
                   <span class="n">stimuli</span><span class="o">=</span><span class="n">stimuli</span><span class="p">,</span>
                   <span class="n">action_options</span><span class="o">=</span><span class="n">action_options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.from_pkl"><a class="viewcode-back" href="../data.html#data.Data.from_pkl">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pkl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                 <span class="n">file_name_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">terminal_ID</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">participantID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span>
                 <span class="n">feedbacks</span><span class="o">=</span><span class="s1">&#39;feedbacks&#39;</span><span class="p">,</span>
                 <span class="n">stimuli</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">action_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">group_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">extra_processing</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import data from a folder full of .pkl files, where each file contains the information of one participant.</span>
<span class="sd">        This will principally be used to import data stored by task simulations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : string, optional</span>
<span class="sd">            The folder where the data can be found. Default is the current folder.</span>
<span class="sd">        file_name_filter : callable, string, list of strings or None, optional</span>
<span class="sd">            A function to process the file names or a list of possible prefixes as strings or a single string.</span>
<span class="sd">            Default ``None``, no file names removed</span>
<span class="sd">        terminal_ID : bool, optional</span>
<span class="sd">            Is there an ID number at the end of the filename? If not then a more general search will be performed.</span>
<span class="sd">            Default ``True``</span>
<span class="sd">        participantID : string, optional</span>
<span class="sd">            The dict key where the participant ID can be found. Default ``None``, which results in the file name being</span>
<span class="sd">            used.</span>
<span class="sd">        choices : string, optional</span>
<span class="sd">            The dict key where the participant choices can be found. Default ``&#39;actions&#39;``</span>
<span class="sd">        feedbacks : string, optional</span>
<span class="sd">            The dict key where the feedbacks the participant received can be found. Default ``&#39;feedbacks&#39;``</span>
<span class="sd">        stimuli : string or list of strings, optional</span>
<span class="sd">            The dict keys where the stimulus cues for each trial can be found. Default ``&#39;None&#39;``</span>
<span class="sd">        action_options : string or list of strings or None or one element list with a list, optional</span>
<span class="sd">            If a string or list of strings these are treated as dict keys where the valid actions for each trial can</span>
<span class="sd">            be found. If None then all trials will use all available actions. If the list contains one list then it will</span>
<span class="sd">            be treated as a list of valid actions for each trialstep. Default ``&#39;None&#39;``</span>
<span class="sd">        group_by : list of strings, optional</span>
<span class="sd">            A list of parts of filenames that are repeated across participants, identifying all the files that should</span>
<span class="sd">            be grouped together to form one participants data. The rest of the filename is assumed to identify the</span>
<span class="sd">            participant. Default is ``None``</span>
<span class="sd">        extra_processing : callable, optional</span>
<span class="sd">            A function that modifies the dictionary of data read for each participant in such that it is appropriate</span>
<span class="sd">            for fitting. Default is ``None``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Data : Data class instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__folder_path_cleaning</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">files</span><span class="p">,</span> <span class="n">file_IDs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__locate_files</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;pkl&quot;</span><span class="p">,</span> <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">,</span>
                                             <span class="n">terminal_ID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">)</span>

        <span class="n">participant_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">fileID</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">file_IDs</span><span class="p">):</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">o</span><span class="p">:</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data coming from ``.pkl`` files expected to be dictionaries. Found </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">dat</span><span class="p">)))</span>

                <span class="n">dat</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="n">dat</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">folder_path</span>

                <span class="n">file_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()}</span>

            <span class="k">if</span> <span class="n">participantID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_data</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">fileID</span>

            <span class="n">participant_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">participantID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">participantID</span> <span class="o">=</span> <span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>

        <span class="n">participant_processed_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__clean_data</span><span class="p">(</span><span class="n">participant_data</span><span class="p">,</span>
                                                      <span class="n">extra_processing</span><span class="o">=</span><span class="n">extra_processing</span><span class="p">,</span>
                                                      <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">participant_processed_data</span><span class="p">,</span>
                   <span class="n">participantID</span><span class="o">=</span><span class="n">participantID</span><span class="p">,</span>
                   <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                   <span class="n">feedbacks</span><span class="o">=</span><span class="n">feedbacks</span><span class="p">,</span>
                   <span class="n">stimuli</span><span class="o">=</span><span class="n">stimuli</span><span class="p">,</span>
                   <span class="n">action_options</span><span class="o">=</span><span class="n">action_options</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">participants</span><span class="p">,</span>
                 <span class="n">participantID</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="s1">&#39;actions&#39;</span><span class="p">,</span>
                 <span class="n">feedbacks</span><span class="o">=</span><span class="s1">&#39;feedbacks&#39;</span><span class="p">,</span>
                 <span class="n">stimuli</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">action_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">process_data_function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        participants : list of dict</span>
<span class="sd">            Each dictionary contains the information for one participant</span>
<span class="sd">        participantID : string, optional</span>
<span class="sd">            The dict key where the participant ID can be found. Default ``ID``</span>
<span class="sd">        choices : string, optional</span>
<span class="sd">            The dict key where the participant choices can be found. Default ``&#39;actions&#39;``</span>
<span class="sd">        feedbacks : string, optional</span>
<span class="sd">            The dict key where the feedbacks the participant received can be found. Default ``&#39;feedbacks&#39;``</span>
<span class="sd">        stimuli : string or list of strings, optional</span>
<span class="sd">            The dict keys where the stimulus cues for each trial can be found. Default ``&#39;None&#39;``</span>
<span class="sd">        action_options : string or list of strings or one element list with a list, optional</span>
<span class="sd">            The dict keys where the valid actions for each trial can be found as a single key or list of keys.</span>
<span class="sd">            If ``None`` then the action list is considered to stay constant. If the list contains one list then it will</span>
<span class="sd">            be treated as a list of valid actions for each trialstep. Default ``&#39;None&#39;``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_function</span> <span class="o">=</span> <span class="n">process_data_function</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">process_data_function</span><span class="p">):</span>
            <span class="n">participant_data</span> <span class="o">=</span> <span class="n">process_data_function</span><span class="p">(</span><span class="n">participants</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">process_data_function</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">participant_data</span> <span class="o">=</span> <span class="n">participants</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">participantID</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;participantID should be a string not a </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">participantID</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">choices</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;choices should be a string not a </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">choices</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feedbacks</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;feedbacks should be a string not a </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">feedbacks</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">stimuli</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stimuli</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">combining_stimuli</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stimuli</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">combining_stimuli</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stimuli</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;stimuli in the list should be strings: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stimuli</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;stimuli should be a string or list of strings not a </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">stimuli</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">action_options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action_options</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">combining_action_options</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action_options</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">action_options</span><span class="p">):</span>
                <span class="n">combining_action_options</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">action_options</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">combining_action_options</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The list of action_options should contain strings or one example of trial valid action choices: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action_options</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;action_options should be a string, a list of strings or a list containing one example of trial valid action choices, not a </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">action_options</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">IDs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">participant_data</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;participants must be in the form of a dict, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)))</span>

            <span class="n">keys</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">participantID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;participantID key not found in participant data: `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">participantID</span><span class="p">))</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;participantID value must be a string. Found </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">])))</span>
            <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">IDError</span><span class="p">(</span><span class="s2">&quot;participantID must be unique. Found more than one instance of `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">participantID</span> <span class="o">=</span> <span class="n">participantID</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">IDs</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]]</span> <span class="o">=</span> <span class="n">loc</span>

            <span class="k">if</span> <span class="n">choices</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;choices key not found in participant </span><span class="si">{}</span><span class="s2"> data: `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="n">choices</span><span class="p">))</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">choices</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;choices value must be a list or numpy array. Found </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">choices</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>

            <span class="k">if</span> <span class="n">feedbacks</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;feedbacks key not found in participant </span><span class="si">{}</span><span class="s2"> data: `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="n">feedbacks</span><span class="p">))</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">feedbacks</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;feedbacks value must be a list or numpy array. Found </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">feedbacks</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feedbacks</span> <span class="o">=</span> <span class="n">feedbacks</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">choices</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">feedbacks</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">LengthError</span><span class="p">(</span><span class="s1">&#39;The number of values for choices and feedbacks must be the same: </span><span class="si">{}</span><span class="s1"> choices and </span><span class="si">{}</span><span class="s1"> feedbacks for participant `</span><span class="si">{}</span><span class="s1">`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">choices</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">feedbacks</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">combining_stimuli</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stimuli</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stimuli</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">stimuli</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;stimuli key not found in participant </span><span class="si">{}</span><span class="s2"> data: `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="n">stimuli</span><span class="p">))</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">stimuli</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;stimuli value must be a list or numpy array. Found </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">stimuli</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stimuli</span> <span class="o">=</span> <span class="n">stimuli</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">stimuli</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;stimuli keys not found in participant </span><span class="si">{}</span><span class="s2"> data: `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="n">stimuli</span><span class="p">))</span>
                <span class="n">cues_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">s</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stimuli</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cues_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">cues_list</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="kc">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cues_list</span><span class="p">]):</span>
                        <span class="c1"># I did not expect this</span>
                        <span class="k">raise</span> <span class="n">error</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">DimentionError</span><span class="p">(</span><span class="s2">&quot;If you are using separate keys for each stimulus cue, they must all be 1D lists&quot;</span><span class="p">)</span>
                <span class="n">stimuli_combined_name</span> <span class="o">=</span> <span class="s2">&quot;cues_combined&quot;</span>
                <span class="k">if</span> <span class="n">stimuli_combined_name</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Unexpected use of key `</span><span class="si">{}</span><span class="s2">`. Use other name&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stimuli_combined_name</span><span class="p">))</span>
                <span class="n">p</span><span class="p">[</span><span class="n">stimuli_combined_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cues_array</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stimuli</span> <span class="o">=</span> <span class="n">stimuli_combined_name</span>

            <span class="k">if</span> <span class="n">stimuli</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">choices</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stimuli</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="n">LengthError</span><span class="p">(</span><span class="s1">&#39;The number of values for choices and stimuli must be the same: </span><span class="si">{}</span><span class="s1"> choices and </span><span class="si">{}</span><span class="s1"> stimuli for participant `</span><span class="si">{}</span><span class="s1">`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">choices</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stimuli</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">combining_action_options</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">action_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">action_options</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action_options</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">action_options</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">action_options_constant_name</span> <span class="o">=</span> <span class="s1">&#39;constant_valid_actions&#39;</span>
                    <span class="n">participant_data</span><span class="p">[</span><span class="n">loc</span><span class="p">][</span><span class="n">action_options_constant_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">action_options</span> <span class="o">=</span> <span class="n">action_options_constant_name</span>
                <span class="k">elif</span> <span class="n">action_options</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;action_options key not found in participant </span><span class="si">{}</span><span class="s2"> data: `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="n">action_options</span><span class="p">))</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">action_options</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;action_options value must be a list or numpy array. Found </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">action_options</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">action_options</span> <span class="o">=</span> <span class="n">action_options</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">action_options</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;action_options keys not found in participant </span><span class="si">{}</span><span class="s2"> data: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">],</span> <span class="n">action_options</span><span class="p">))</span>
                <span class="n">options_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">a</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">action_options</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">options_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">options_list</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="kc">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">options_list</span><span class="p">]):</span>
                        <span class="c1"># I did not expect this</span>
                        <span class="k">raise</span> <span class="n">error</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">DimentionError</span><span class="p">(</span>
                            <span class="s2">&quot;If you are using separate keys for each action option, they must all be 1D lists&quot;</span><span class="p">)</span>
                <span class="n">action_options_combined_name</span> <span class="o">=</span> <span class="s2">&quot;valid_actions_combined&quot;</span>
                <span class="k">if</span> <span class="n">action_options_combined_name</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Unexpected use of key `</span><span class="si">{}</span><span class="s2">`. Use other name&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action_options_combined_name</span><span class="p">))</span>
                <span class="n">participant_data</span><span class="p">[</span><span class="n">loc</span><span class="p">][</span><span class="n">action_options_combined_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">options_array</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action_options</span> <span class="o">=</span> <span class="n">action_options_combined_name</span>

            <span class="k">if</span> <span class="n">action_options</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">choices</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">action_options</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">action_options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">LengthError</span><span class="p">(</span><span class="s1">&#39;The number of values for choices and valid actions must be the same: </span><span class="si">{}</span><span class="s1"> choices and </span><span class="si">{}</span><span class="s1"> action_options for participant `</span><span class="si">{}</span><span class="s1">`&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">choices</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">action_options</span><span class="p">]),</span> <span class="n">p</span><span class="p">[</span><span class="n">participantID</span><span class="p">]))</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">participant_data</span><span class="p">)</span>

<div class="viewcode-block" id="Data.extend"><a class="viewcode-back" href="../data.html#data.Data.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Combines two Data instances into one</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iterable : Data instance or list of participant dicts</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">Data</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">participantID</span> <span class="o">!=</span> <span class="n">iterable</span><span class="o">.</span><span class="n">participantID</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;participantID ``</span><span class="si">{}</span><span class="s1">`` cannot be extended with ``</span><span class="si">{}</span><span class="s1">``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">participantID</span><span class="p">,</span> <span class="n">iterable</span><span class="o">.</span><span class="n">participantID</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">!=</span> <span class="n">iterable</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;choices ``</span><span class="si">{}</span><span class="s1">`` cannot be extended with ``</span><span class="si">{}</span><span class="s1">``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">,</span> <span class="n">iterable</span><span class="o">.</span><span class="n">choices</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feedbacks</span> <span class="o">!=</span> <span class="n">iterable</span><span class="o">.</span><span class="n">feedbacks</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;feedbacks ``</span><span class="si">{}</span><span class="s1">`` cannot be extended with ``</span><span class="si">{}</span><span class="s1">``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feedbacks</span><span class="p">,</span> <span class="n">iterable</span><span class="o">.</span><span class="n">feedbacks</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stimuli</span> <span class="o">!=</span> <span class="n">iterable</span><span class="o">.</span><span class="n">stimuli</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;stimuli ``</span><span class="si">{}</span><span class="s1">`` cannot be extended with ``</span><span class="si">{}</span><span class="s1">``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stimuli</span><span class="p">,</span> <span class="n">iterable</span><span class="o">.</span><span class="n">stimuli</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_options</span> <span class="o">!=</span> <span class="n">iterable</span><span class="o">.</span><span class="n">action_options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;action_options ``</span><span class="si">{}</span><span class="s1">`` cannot be extended with ``</span><span class="si">{}</span><span class="s1">``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_options</span><span class="p">,</span> <span class="n">iterable</span><span class="o">.</span><span class="n">action_options</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_function</span> <span class="o">!=</span> <span class="n">iterable</span><span class="o">.</span><span class="n">process_function</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;process_function ``</span><span class="si">{}</span><span class="s1">`` cannot be extended with ``</span><span class="si">{}</span><span class="s1">``&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_function</span><span class="p">,</span> <span class="n">iterable</span><span class="o">.</span><span class="n">process_function</span><span class="p">))</span>

            <span class="n">IDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">number_IDs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">id_key</span><span class="p">,</span> <span class="n">id_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iterable</span><span class="o">.</span><span class="n">IDs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">id_key</span> <span class="ow">in</span> <span class="n">IDs</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">IDError</span><span class="p">(</span><span class="s2">&quot;participantID must be unique. Found more than one instance of `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">id_key</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">IDs</span><span class="p">[</span><span class="n">id_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_IDs</span> <span class="o">+</span> <span class="n">id_val</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span>
                       <span class="n">participantID</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">participantID</span><span class="p">,</span>
                       <span class="n">choices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">,</span>
                       <span class="n">feedbacks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedbacks</span><span class="p">,</span>
                       <span class="n">stimuli</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stimuli</span><span class="p">,</span>
                       <span class="n">action_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">action_options</span><span class="p">,</span>
                       <span class="n">process_data_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_function</span>
                       <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Data</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">eq_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item1</span><span class="p">,</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">item1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="n">item2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">eq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">item1</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="o">!=</span> <span class="n">item2</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">eq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eq_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">eq_list</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__folder_path_cleaning</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>

        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">folder_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="n">folder_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">return</span> <span class="n">folder_path</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__locate_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">file_name_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">terminal_ID</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produces the list of valid input files</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : string</span>
<span class="sd">            The folder string should end in a ``/``</span>
<span class="sd">        file_type : string</span>
<span class="sd">            The file extension found after the ``.``.</span>
<span class="sd">        file_name_filter : callable, string, list of strings or None, optional</span>
<span class="sd">            A function to process the file names or a list of possible prefixes as strings or a single string.</span>
<span class="sd">            Default ``None``, no file names removed</span>
<span class="sd">        terminal_ID : bool, optional</span>
<span class="sd">            Is there an ID number at the end of the filename? If not then a more general search will be performed.</span>
<span class="sd">            Default ``True``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dataFiles : list</span>
<span class="sd">            A sorted list of the the files</span>
<span class="sd">        fileIDs : list of strings</span>
<span class="sd">            A list of unique parts of the filenames, in the order of dataFiles</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        sortStrings : sorts the files found</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">data_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">file_type</span><span class="p">)]</span>

        <span class="n">valid_file_names</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__valid_files</span><span class="p">(</span><span class="n">data_files</span><span class="p">,</span> <span class="n">file_name_filter</span><span class="o">=</span><span class="n">file_name_filter</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_file_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileError</span><span class="p">(</span><span class="s1">&#39;No data files found&#39;</span><span class="p">)</span>

        <span class="n">sorted_files</span><span class="p">,</span> <span class="n">file_IDs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__sort_strings</span><span class="p">(</span><span class="n">valid_file_names</span><span class="p">,</span>
                                                    <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">file_type</span><span class="p">,</span>
                                                    <span class="n">terminalID</span><span class="o">=</span><span class="n">terminal_ID</span><span class="p">,</span>
                                                    <span class="n">return_IDs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sorted_files</span><span class="p">,</span> <span class="n">file_IDs</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__valid_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data_files</span><span class="p">,</span> <span class="n">file_name_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take a list of file names in the folder and a filter function and returns the filtered list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_files : list of strings</span>
<span class="sd">            The list of file names without paths</span>
<span class="sd">        file_name_filter : callable, string, list of strings or None, optional</span>
<span class="sd">            A function to process the file names or a list of possible prefixes as strings or a single string.</span>
<span class="sd">            Default ``None``, no file names removed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        valid_file_list : list of strings</span>
<span class="sd">            A subset of the data_files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">file_name_filter</span><span class="p">):</span>
            <span class="n">valid_file_list</span> <span class="o">=</span> <span class="n">file_name_filter</span><span class="p">(</span><span class="n">data_files</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_name_filter</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="n">valid_file_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__file_prefix_filter</span><span class="p">(</span><span class="n">data_files</span><span class="p">,</span> <span class="p">[</span><span class="n">file_name_filter</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_name_filter</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">valid_file_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__file_prefix_filter</span><span class="p">(</span><span class="n">data_files</span><span class="p">,</span> <span class="n">file_name_filter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_file_list</span> <span class="o">=</span> <span class="n">data_files</span>

        <span class="k">return</span> <span class="n">valid_file_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__sort_strings</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">unordered_list</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">terminalID</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_IDs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes an unordered list of strings and sorts them if possible and necessary</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unordered_list : list of strings</span>
<span class="sd">            A list of valid strings</span>
<span class="sd">        suffix : string</span>
<span class="sd">            A known suffix for the string</span>
<span class="sd">        terminalID : bool, optional</span>
<span class="sd">            Is there an ID number at the end of the filename? If not then a more general search will be performed. Default ``True``</span>
<span class="sd">        return_IDs : bool, optional</span>
<span class="sd">            Specify if the fileIDs should be returned. Default ``False``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sortedList : list of strings</span>
<span class="sd">            A sorted list of the the strings</span>
<span class="sd">        fileIDs : list of strings</span>
<span class="sd">            A list of unique parts of the filenames, in the order of dataFiles. Only returned if ``return_IDs=True``</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        int_core : sorts the strings with the prefix and suffix removed if they are a number</span>
<span class="sd">        get_unique_prefix : identifies prefixes all strings have</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unordered_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unordered_list</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]</span>

        <span class="n">suffixLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">terminalID</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__get_unique_suffix</span><span class="p">(</span><span class="n">unordered_list</span><span class="p">,</span> <span class="n">suffixLen</span><span class="p">)</span>
            <span class="n">suffixLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__get_unique_prefix</span><span class="p">(</span><span class="n">unordered_list</span><span class="p">,</span> <span class="n">suffixLen</span><span class="p">)</span>

        <span class="n">sortedList</span><span class="p">,</span> <span class="n">fileIDs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__int_core</span><span class="p">(</span><span class="n">unordered_list</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sortedList</span><span class="p">:</span>
            <span class="n">sortedList</span><span class="p">,</span> <span class="n">fileIDs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__str_core</span><span class="p">(</span><span class="n">unordered_list</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">),</span> <span class="n">suffixLen</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_IDs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sortedList</span><span class="p">,</span> <span class="n">fileIDs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sortedList</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_unique_suffix</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">,</span> <span class="n">knownSuffixLen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unorderedList : list of strings</span>
<span class="sd">            A list of strings to be ordered</span>
<span class="sd">        knownSuffixLen : int</span>
<span class="sd">            The length of the suffix identified so far</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        suffixLen : int</span>
<span class="sd">            The length of the discovered suffix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">knownSuffixLen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>  <span class="c1"># Starting with the known string-suffix</span>
            <span class="n">sec</span> <span class="o">=</span> <span class="n">unorderedList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="n">i</span><span class="p">:]</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">((</span><span class="n">sec</span> <span class="o">==</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">:]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">unorderedList</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">unorderedList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_unique_prefix</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">,</span> <span class="n">suffixLen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identifies any initial part of strings that are identical</span>
<span class="sd">        for all string</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unorderedList : list of strings</span>
<span class="sd">            A list of strings to be ordered</span>
<span class="sd">        suffixLen : int</span>
<span class="sd">            The length of the identified suffix</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        prefix : string</span>
<span class="sd">            The initial part of the strings that is identical for all strings in</span>
<span class="sd">            the list</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; dataFiles = [&#39;subj1.mat&#39;, &#39;subj11.mat&#39;, &#39;subj2.mat&#39;]</span>
<span class="sd">        &gt;&gt;&gt; suffixLen = 4</span>
<span class="sd">        &gt;&gt;&gt; data.__get_unique_prefix(dataFiles, suffixLen)</span>
<span class="sd">        &#39;subj&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">suffixLen</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>  <span class="c1"># Assuming the prefix might be the string-suffix</span>
            <span class="n">sec</span> <span class="o">=</span> <span class="n">unorderedList</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">((</span><span class="n">sec</span> <span class="o">==</span> <span class="n">d</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">unorderedList</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">unorderedList</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__str_core</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">,</span> <span class="n">prefixLen</span><span class="p">,</span> <span class="n">suffixLen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes the *core* part of a string and, assuming it is a string,</span>
<span class="sd">        sorts them. Returns the list sorted</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unorderedList : list of strings</span>
<span class="sd">            The list of strings to be sorted</span>
<span class="sd">        prefixLen : int</span>
<span class="sd">            The length of the unchanging start of each filename</span>
<span class="sd">        suffixLen : int</span>
<span class="sd">            The length of the unchanging end of each filename</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        orderedList : list of strings</span>
<span class="sd">            The strings now sorted</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sortingList</span> <span class="o">=</span> <span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">prefixLen</span><span class="p">:</span><span class="o">-</span><span class="n">suffixLen</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">unorderedList</span><span class="p">)</span>
        <span class="n">sortedList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sortingList</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">orderedList</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sortedList</span><span class="p">]</span>
        <span class="n">fileIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sortedList</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">orderedList</span><span class="p">,</span> <span class="n">fileIDs</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__int_core</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes the *core* part of a string and, assuming it is an integer, sorts them.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        unorderedList : list of strings</span>
<span class="sd">            The list of strings to be sorted</span>
<span class="sd">        prefix : string</span>
<span class="sd">            The unchanging part of the start each string</span>
<span class="sd">        suffix : string</span>
<span class="sd">            The unchanging known end of each string</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sortedStrings : list of strings</span>
<span class="sd">            The strings now sorted</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; dataFiles = [&#39;me001.mat&#39;, &#39;me051.mat&#39;, &#39;me002.mat&#39;, &#39;me052.mat&#39;]</span>
<span class="sd">        &gt;&gt;&gt; prefix = &#39;me0&#39;</span>
<span class="sd">        &gt;&gt;&gt; suffix = &#39;.mat&#39;</span>
<span class="sd">        &gt;&gt;&gt; data.__int_core(dataFiles, prefix, suffix)</span>
<span class="sd">        ([u&#39;me001.mat&#39;, u&#39;me002.mat&#39;, u&#39;me051.mat&#39;, u&#39;me052.mat&#39;], [&#39;1&#39;, &#39;2&#39;, &#39;51&#39;, &#39;52&#39;])</span>
<span class="sd">        &gt;&gt;&gt; dataFiles = [&#39;subj1.mat&#39;, &#39;subj11.mat&#39;, &#39;subj12.mat&#39;, &#39;subj2.mat&#39;]</span>
<span class="sd">        &gt;&gt;&gt; prefix = &#39;subj&#39;</span>
<span class="sd">        &gt;&gt;&gt; suffix = &#39;mat&#39;</span>
<span class="sd">        &gt;&gt;&gt; data.__int_core(dataFiles, prefix, suffix)</span>
<span class="sd">        ([&#39;subj1.mat&#39;, &#39;subj2.mat&#39;, &#39;subj11.mat&#39;, &#39;subj12.mat&#39;], [&#39;1&#39;, &#39;2&#39;, &#39;11&#39;, &#39;12&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
                <span class="n">testItem</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">testItem</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
            <span class="n">core</span> <span class="o">=</span> <span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span><span class="o">-</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">suffix</span><span class="p">))],</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">core</span> <span class="o">=</span> <span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):],</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unorderedList</span><span class="p">)]</span>
        <span class="n">coreInt</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">core</span><span class="p">]</span>

        <span class="n">coreSorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">coreInt</span><span class="p">)</span>
        <span class="n">coreStr</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">coreSorted</span><span class="p">]</span>

        <span class="n">sortedStrings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">prefix</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">core</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">s</span><span class="p">,</span> <span class="n">suffix</span><span class="p">])</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">coreStr</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">sortedStrings</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">coreStr</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__file_prefix_filter</span><span class="p">(</span><span class="n">data_files</span><span class="p">,</span> <span class="n">file_filter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a list of file names and a list of strings and returns the file names that start with any of the file_name_filter</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_files : list of strings</span>
<span class="sd">            The list of file names without paths</span>
<span class="sd">        file_filter : list of strings</span>
<span class="sd">            The list of possible prefixes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        valid_file_list : list of strings</span>
<span class="sd">            A subset of the data_files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valid_file_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">data_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">file_filter</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="n">valid_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_file_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__clean_data</span><span class="p">(</span><span class="n">participant_data</span><span class="p">,</span> <span class="n">extra_processing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group_by</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">grouped_data</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">participant_data</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">DATA_KEYWORDS</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_by</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                        <span class="n">id_label</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">id_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">:</span>
                            <span class="n">grouped_data</span><span class="p">[</span><span class="n">id_label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="c1">#grouped_data[id_label].update({&#39;{}_{}&#39;.format(k, group): v for k, v in dat.iteritems()})</span>
                        <span class="n">grouped_data</span><span class="p">[</span><span class="n">id_label</span><span class="p">][</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span>

            <span class="n">merged_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">id_label</span><span class="p">,</span> <span class="n">group_data</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">group_merged_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;merge_id&#39;</span><span class="p">:</span> <span class="n">id_label</span><span class="p">}</span>
                <span class="n">keyset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">[</span><span class="n">id_label</span><span class="p">]</span><span class="o">.</span><span class="n">itervalues</span><span class="p">()])</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keyset</span><span class="p">:</span>
                    <span class="n">key_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">group_data</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_by</span> <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_data</span>
                                                                                  <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group_data</span><span class="p">[</span><span class="n">group</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">list_all_equal</span><span class="p">(</span><span class="n">key_values</span><span class="p">):</span>
                        <span class="n">group_merged_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">key_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_by</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_data</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">group_data</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
                                <span class="n">group_merged_data</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">key_values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">merged_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_merged_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">merged_data</span> <span class="o">=</span> <span class="n">participant_data</span>

        <span class="k">if</span> <span class="n">extra_processing</span><span class="p">:</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file_data</span> <span class="ow">in</span> <span class="n">merged_data</span><span class="p">:</span>
                <span class="n">dat_dict</span> <span class="o">=</span> <span class="n">extra_processing</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dat_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span><span class="s1">&#39;The extra_processing function must return the data&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dat_dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="n">merged_data</span>

        <span class="k">return</span> <span class="n">processed_data</span></div>

<span class="c1"># TODO work out how you want to integrate this into getFiles</span>
<div class="viewcode-block" id="sort_by_last_number"><a class="viewcode-back" href="../data.html#data.sort_by_last_number">[docs]</a><span class="k">def</span> <span class="nf">sort_by_last_number</span><span class="p">(</span><span class="n">dataFiles</span><span class="p">):</span>

    <span class="c1"># sort by the last number on the filename</span>
    <span class="n">footSplit</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.(?:[a-zA-Z]+)$&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dataFiles</span><span class="p">]</span>
    <span class="n">numsplit</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+(\.\d+|$)?$&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">(</span><span class="n">footSplit</span><span class="p">,</span> <span class="n">dataFiles</span><span class="p">)]</span>

    <span class="c1"># check if number part is a float or an int (assuming the same for all) and use the appropriate conversion</span>
    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">dataFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">numsplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">footSplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
        <span class="n">numRepr</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numRepr</span> <span class="o">=</span> <span class="nb">int</span>

    <span class="n">fileNameSections</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span> <span class="n">numRepr</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">d</span><span class="p">]),</span> <span class="n">f</span><span class="p">[</span><span class="n">d</span><span class="p">:])</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">(</span><span class="n">numsplit</span><span class="p">,</span> <span class="n">footSplit</span><span class="p">,</span> <span class="n">dataFiles</span><span class="p">)]</span>

    <span class="c1"># Sort the keys for groupFiles</span>
    <span class="n">sortedFileNames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fileNameSections</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">fileGroup</span><span class="p">:</span> <span class="n">fileGroup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">dataSortedFiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">head</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="n">foot</span> <span class="k">for</span> <span class="n">head</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">foot</span> <span class="ow">in</span> <span class="n">sortedFileNames</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">dataSortedFiles</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyHPDM 0.9.9 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2020, Dominic Hunt.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>